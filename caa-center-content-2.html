<div class="row center-content">
    <div class="filter-column">
        <div class="filters">
            <div class="filter-text">
                <input type="text" id="text-input" class="filter-text-input" />
                <button class="go-button" onClick="activateTextSearch()">Go</button>
            </div>
            <div class="filter-vocab">
                <h4>Additional Filters</h4>
                <span class="label-desc">These filter lists are long; click to expand.</span>
                <div id="filter-terms">
                    <h5 class="clickable-title" onClick="toggleFilterList('terms')">Filter by Medium</h5>
                    <ul class="filter-list" id="filter-terms-list" style="display: none"></ul>
                </div>
                <div id="filter-cultures">
                    <h5 class="clickable-title" onClick="toggleFilterList('cultures')">Filter by Cultural Affiliation</h5>
                    <ul class="filter-list" id="filter-cultures-list" style="display: none"></ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col artists">
        <div class="content-header">
            <h1>CPL's Chicago Artists File</h1>
            <p id="helper-text">Please search for an artist by name, or select filters from the left.</p>
        </div>
        <div class="results-target" id="results"></div>
        <div id="intro-text">Intro text.  Lorem ipsum dolor sit amet consectetur adipisicing elit. Quae totam repudiandae quo esse reprehenderit, minus dolorum! Repellendus alias consequatur pariatur repudiandae, minus error? Nostrum, perferendis blanditiis dignissimos eveniet vel necessitatibus.</div>
    </div>
</div>
<script>
    // nonfunctions: 
        // iterate over filter list arrays (terms, cultures); draw them with checkboxes
        for (var m in artTerms) {
                $('#filter-terms-list').append(
                    '<li class="caa-filter">' +
                            '<input name="contentFilter" type="checkbox" id="filter-type-'  + artTerms[m].replace(/ /g,"") + '" class="filter-cultures" value="t-'  + artTerms[m].replace(/ /g,"") + '">' + 
                            '<label for="filter-type-'  + artTerms[m].replace(/ /g,"") + '"> '  + artTerms[m] + '</label>' + 
                    '</li>');
            }
        for (var c in cultures) {
            $('#filter-cultures-list').append(
                '<li class="caa-filter">' +
                        '<input name="contentFilter" type="checkbox" id="filter-type-'  + cultures[c].replace(/ /g,"") + '" class="filter-cultures" value="c-'  + cultures[c].replace(/ /g,"") + '">' + 
                        '<label for="filter-type-'  + cultures[c].replace(/ /g,"") + '"> '  + cultures[c] + '</label>' + 
                '</li>');
        }
        // listen for enter key while in input field and activateTextSearch()
        $( document ).ready(function() {
            $('#text-input').keypress(function(e){
                if(e.keyCode==13)
                    activateTextSearch();
            });
        });
    // globals: 
            // results array is the array of objects for search results
            // results html is ithe results array with html added
        var resultsArray = [],
            resultsHtml = [],
            $filterCheckboxes = $('input[type="checkbox"]');
    // functions: 
        // get text input from text box, sends it to textFilter(), if n o input, replaces helper text
            function activateTextSearch(){
                var input = $('#text-input').val();
                if (input.length > 0) {
                    ( resultsArray.length > 0 ? textFilter(input, resultsArray) : textFilter(input, caaJson) );
                    htmlifyResult();
                } else if (input == null || input.length < 1) {
                    clearCenter();
                    $('#helper-text').append('Please search for an artist by name, or select filters from the left.');
                }
            }
        // show/hide the lists of filters    
            function toggleFilterList(filterList){
                $('#filter-' + filterList + '-list').slideToggle();
            }
        // clear out middle section, used a lot
            function clearCenter(){
                $('#helper-text').empty();
                $('#results').empty();
                $('#intro-text').empty();
            }
        // when a checkbox status changes, or go button is clicked, check to see if there are already results; 
            // if there are already results, filter existing results
            // if there are no results, iterate over entire db
                $filterCheckboxes.on('change', function(){
                    var dataFilters = [];
                    $filterCheckboxes.filter(':checked').each(function() {
                        dataFilters.push(this.value);
                    });  
                    var searchArray = ( resultsArray.length > 0 ? resultsArray : caaJson );
                    resultsArray = [];
                    for ( var a in searchArray) {
                        textFilter(searchArray[a]);
                        dataFilter(searchArray[a]);
                    }
                });    
        // filters 
            function textFilter(userInput, searchArray){
                var input = $('#text-input').val();
                if (searchArray.name.toUpperCase().indexOf(input.toUpperCase()) === 0 ){
                    resultsArray.push(searchArray[k]);
                }
            }
            function dataFilter(selectedFilters, searchArray){
                // var input = $('#text-input').val();
                // if (input.length > 0) {
                //     textFilter(input, searchArray);
                // }
                resultsArray = [];
                var culturesCheck = false,
                    termsCheck = false,
                    cFilters = [],
                    tFilters = [];

                for ( var a in searchArray) {
                    for ( var f in selectedFilters ) {
                        if (selectedFilters[f].indexOf('c-') === 0) {
                            cFilters.push(selectedFilters[f]);
                            for (var c in searchArray[a].cultures ){
                                if (searchArray[a].cultures[c].indexOf(selectedFilters[f].substr(2,255)) != -1){
                                    culturesCheck = true;
                                }
                            }
                        } else if (selectedFilters[f].indexOf('t-') === 0) {
                            tFilters.push(selectedFilters[f]);
                            for (var t in searchArray[a].artTerms ){
                                console.log(selectedFilters[f].substr(2,255) + ' ' + searchArray[a].artTerms[t]);
                                if (searchArray[a].artTerms[t].indexOf(selectedFilters[f].substr(2,255))){
                                    termsCheck = true;
                                }
                            }
                        }
                    }
                    if ((culturesCheck || cFilters.length === 0) && (termsCheck || tFilters.length === 0)) {
                        console.log("adding " + searchArray[a].name)
                        resultsArray.push(searchArray[a]);
                    }
                }
                console.log(resultsArray);
                if (resultsArray.length === 0 ){
                    clearCenter();
                    $('#helper-text').empty().append('No results.');

                } else {
                    htmlifyResult();
                }
            }    
        // unique for each db, this creates a html presentation for a result 
            function htmlifyResult(){
                clearCenter();
                count = 0;
                function arrayer(n, prepend){
                    var string = ''
                    for (var e in n){
                        var bumper = '';
                        if (string != ''){
                            bumper = ', ';
                        }
                        string += bumper + prepend + n[e];
                    }
                    return string;
                }
                function arrayerCitations(n){
                    var citations = '';
                    for (var c in n){
                        var author = n[c].firstName + ' ' + n[c].lastName;
                        var callNo = n[c].callNumber.replace(/ /g,"+");
                        var url = 'http://chipublib.bibliocommons.com/search?custom_query=callnumber%3A%28%22' + callNo + '*%22%29';
                        citations += '<li><a href=' + url + '>' + n[c].title + '</a>' + (author != ' ' ? ' by ' + n[c].firstName + ' ' + n[c].lastName : '' ) + '</li>'
                    }
                    return '<ul>' + citations + '</ul>';
                }
                for (var h in resultsArray) {
                    count++;
                    resultsHtml.push('<div class="artist" data-filters="' + 
                            (resultsArray[h].artTerms != '' ? arrayer(resultsArray[h].artTerms, 't-').replace(/ /g,"") : '' ) +
                            (resultsArray[h].artTerms != '' && resultsArray[h].cultures != '' ? ',' : '') + 
                            (resultsArray[h].cultures != '' ? arrayer(resultsArray[h].cultures, 'c-').replace(/ /g,"") : '' ) + 
                        '" data-sort="' + resultsArray[h].name + '" id="' + resultsArray[h].accNumber + '"><h2 class="artist-name">' + resultsArray[h].name + '</h2>' + 
                        ((resultsArray[h].dob !=  '' || resultsArray[h].dod != '') ? '<p class="artist-details">' + resultsArray[h].dob + '-' + resultsArray[h].dod + '</p>' : '' ) + 
                        (resultsArray[h].gender != '' ? '<p class="artist-details">Gender: ' + resultsArray[h].gender + '</p>': '') + 
                        (resultsArray[h].artTerms != '' ? '<p class="artist-details">Medium(s): <span>' + arrayer(resultsArray[h].artTerms, '') + '</span></p>' : '' ) + 
                        (resultsArray[h].cultures != '' ? '<p class="artist-details">Cultural Affiliation(s): ' + arrayer(resultsArray[h].cultures, '') + '</p>' : '' ) + 
                        (resultsArray[h].monographs != '' ? '<p class="artist-citations">Citations from the CPL Collection: ' + arrayerCitations(resultsArray[h].monographs) + '</p>' : '' ) + 
                            '<p class="caa-contents-header">Chicago Artists File Contents:' +
                                '<ul class="caa-contents-list">' + 
                                    '<li>File: ' + ( resultsArray[h].file == "TRUE" ? 'Yes' : 'No') + '</li>' +
                                    '<li>Slides: ' + ( resultsArray[h].slides == "TRUE" ? 'Yes' : 'No') + '</li>' +
                                    '<li>Video: ' + ( resultsArray[h].videos == "TRUE" ? 'Yes' : 'No') + '</li>' +
                                    ( resultsArray[h].resume == "TRUE" ? '<li>Resume: Yes </li>' : '') +
                                    ( resultsArray[h].article == "TRUE" ? '<li>Article: Yes </li>' : '') +
                                    ( resultsArray[h].poster == "TRUE" ? '<li>Poster: Yes </li>' : '') +
                                    ( resultsArray[h].folio == "TRUE" ? '<li>Folio: Yes </li>' : '') +
                                    ( resultsArray[h].cdrom == "TRUE" ? '<li>CD-ROM: Yes </li>' : '') +
                                    ( resultsArray[h].artistStatement == "TRUE" ? '<li>Artist Statement: Yes' : '') + 
                                    ( resultsArray[h].galleryNotice == "TRUE" ? '<li>Gallery Notice: Yes' : '') + 
                                '</ul>' +
                            '</p>' +
                            (resultsArray[h].notes != '' ? '<p class="artist-notes">Notes: ' + resultsArray[h].notes + '</p>' : '' ) + 
                        '</div>');
                }
                if ( count > 500 ) {
                    $('#helper-text').empty().append(count + ' results.  Show anyway? <br /><button class="anyway-button" onclick="appendResultsHtml()">Ok</button>');
                } else {
                    appendResultsHtml();
                }
            }
        // sorts results
            jQuery.fn.sortDivs = function sortDivs(sortType) {
                $("> div", this[0]).sort(dec_sort).appendTo(this[0]);
                function dec_sort(a, b){ return ($(b).data(sortType)) < ($(a).data(sortType)) ? 1 : -1; }
            }
        // adds resultsHTML to web page
            function appendResultsHtml(){
                // clearCenter();
                $('#results').append(resultsHtml).sortDivs('sort');
                $('#helper-text').append(count + " results.")
            }
 
</script>